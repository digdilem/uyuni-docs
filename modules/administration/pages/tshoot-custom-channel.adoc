[[troubleshooting-customchannel]]
= Creating Custom Channel without Conflicting Packages

////
PUT THIS COMMENT AT THE TOP OF TROUBLESHOOTING SECTIONS

Troubleshooting format:

One sentence each:
Cause: What created the problem?
Consequence: What does the user see when this happens?
Fix: What can the user do to fix this problem?
Result: What happens after the user has completed the fix?

If more detailed instructions are required, put them in a "Resolving" procedure:
.Procedure: Resolving Widget Wobbles
. First step
. Another step
. Last step
////

////
Cause: Conflicting packages in custom channel
Consequence: Creating bootstrap repo can fail
Fix: Separate trees from each other
Result: Clean and functional boostrap repo will be created
////

When setting up a custom channel with conflicting packages features such as creating a bootstrap repository can result in undefined behavior and make registering clients fail.

For example, conflicting packages with higher version numbers could be
included into the bootstrap repository.
Such packages (for example, [package]``python3-zmq`` or [package]``zeromq``) may corrupt the creation of the bootstrap repository or cause issues during bootstrap of the client.

When the custom channel (for example, an EPEL channel) is added below the parent channel, issues with conflicting packages can not be solved directly.
The way how to solve this is to separate the custom channel from the parent channel.
The custom channel needs to be created in a separate tree.
In case that the custom channel needs to be delivered
as a child, such environemnt can be created using Content Lifecycle Management (CLM).
Sources in a CLM project can be added there from different trees.
Using such an approach, the custom channel stays below the parent within the built environment.
However, the vendor channel tree stays without the custom channel and the bootstrap repository.
Then registering clients works correctly.

When the custom channel with the conflicting packages (salt, zeromq,
and so on) is created as a child channel, following steps can help to
avoid the issue:

.Procedure: Avoiding Conflicting Packages in Custom Channels

. Remove the custom channel as a child channel from parent
channel. More details:
https://documentation.suse.com/suma/4.2/en/suse-manager/administration/custom-channels.html#_manage_custom_channels
. Custom channel needs to be created in a separate tree. More
details:
https://documentation.suse.com/suma/4.2/en/suse-manager/administration/custom-channels.html#_creating_custom_channels_and_repositories
. In order to get the custom channel as a child channel within
Content Lifecycle management:

=> In SUSE Manager webUI -> Content Lifecycle -> Create Project -> put in "Name" and "Label"
=> Attach Source to the project -> use needed vendor channels + custom channel => (sharing example using CentOS8)
=> Add environment into the Project -> example using CentOS8
=> Build the environment environnment by hitting the "Build" button -> it creates an environment (with vendor and custom channels) which can be associated with Activation key and used to bootstrap the client

4. Important note: in the CLM project, it is recommend to add a filter
which filters out (exclude) the problematic/conflicting packages. The
reason for that is that the conflicting packages with higher version
would be installed anyway during the update of the client. More detail
about filtering:
https://documentation.suse.com/suma/4.2/en/suse-manager/administration/content-lifecycle-examples.html#exclude-higher-kernel-version

5. In order to get the latest patches into CLM environment (with
vendor and custom channel), it is needed to re-built the environment
by clicking on "Build" button in the project

6. More details about CLM can be found in:
https://documentation.suse.com/suma/4.2/en/suse-manager/administration/content-lifecycle.html

7. There is another workaround described in release notes:
https://www.suse.com/releasenotes/x86_64/SUSE-MANAGER/4.2/index.html#_epel_and_salt_packages
